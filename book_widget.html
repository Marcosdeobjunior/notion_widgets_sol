<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Widget de Livros</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f2f4f8;
      color: #333;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 250px;
      background-color: #fff;
      padding: 1rem;
      border-right: 1px solid #ddd;
    }

    .main {
      flex: 1;
      padding: 2rem;
    }

    .filters, .genres, .meta {
      margin-bottom: 1rem;
    }

    .filters button, .genres button {
      margin: 0.2rem;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 5px;
      background: #eee;
      cursor: pointer;
      transition: background 0.2s;
    }

    .filters button.active, .genres button.active,
    .filters button:hover, .genres button:hover {
      background: #0078D7;
      color: #fff;
    }

    .card-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
    }

    .card {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 6px;
    }

    .card h3 {
      margin: 0.5rem 0;
    }

    .card .stars {
      color: gold;
    }

    .card .genre, .card .author, .card .status {
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }

    .card button, .card a {
      margin-top: 0.3rem;
      display: inline-block;
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
      border: none;
      border-radius: 4px;
      background: #ddd;
      text-decoration: none;
      color: #333;
      cursor: pointer;
    }

    .meta input {
      width: 100%;
      padding: 0.4rem;
      margin-bottom: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .formulario {
      margin-bottom: 1rem;
    }

    .formulario input, .formulario select {
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .paginacao {
      text-align: center;
      margin-top: 1rem;
    }

    .paginacao button {
      margin: 0 0.3rem;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 4px;
      background: #0078D7;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <div class="meta">
      <h3>Meta Anual</h3>
      <input type="number" id="goal" placeholder="Digite a meta...">
      <div class="status-count">
        <div>Lido: <span id="count-lido">0</span></div>
        <div>A Ler: <span id="count-aler">0</span></div>
        <div>Quero Ler: <span id="count-queroler">0</span></div>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="formulario">
      <input type="text" id="titulo" placeholder="Título">
      <input type="text" id="autor" placeholder="Autor">
      <input type="text" id="genero" placeholder="Gênero">
      <input type="text" id="imagem" placeholder="URL da Imagem">
      <select id="status">
        <option value="A Ler">A Ler</option>
        <option value="Quero Ler">Quero Ler</option>
        <option value="Lido">Lido</option>
      </select>
      <input type="number" id="nota" placeholder="Nota (0-5)">
      <button onclick="adicionarLivro()">Salvar Livro</button>
    </div>

    <div class="filters">
      <button onclick="filtrar('Todos')" class="active">Todos</button>
      <button onclick="filtrar('Favoritos')">Favoritos</button>
      <button onclick="filtrar('A Ler')">A Ler</button>
      <button onclick="filtrar('Quero Ler')">Quero Ler</button>
      <button onclick="filtrar('Lido')">Lido</button>
    </div>

    <div class="genres" id="genre-list"></div>
    <div class="card-list" id="card-list"></div>
    <div class="paginacao" id="paginacao"></div>
  </div>
</div>

<script>
let books = JSON.parse(localStorage.getItem('books')) || [];
let paginaAtual = Number(localStorage.getItem('pagina')) || 1;
let filtroAtual = 'Todos';
let generoAtual = null;
let editandoTitulo = null;
const porPagina = 9;

function saveBooks() {
  localStorage.setItem('books', JSON.stringify(books));
}

function render() {
  let filtrados = books.filter(book => {
    if (filtroAtual === 'Favoritos') return book.favorito;
    if (filtroAtual !== 'Todos' && book.status !== filtroAtual) return false;
    if (generoAtual && book.genero !== generoAtual) return false;
    return true;
  });

  const inicio = (paginaAtual - 1) * porPagina;
  const pagina = filtrados.slice(inicio, inicio + porPagina);
  document.getElementById('card-list').innerHTML = '';

  pagina.forEach(book => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <img src="${book.imagem}" onerror="this.src='https://via.placeholder.com/250x160'">
      <h3>${book.titulo}</h3>
      <div class="author">Autor: ${book.autor}</div>
      <div class="status">Status: ${book.status}</div>
      <div class="stars">${'★'.repeat(book.nota)}${'☆'.repeat(5 - book.nota)}</div>
      <button onclick="toggleFavorito('${book.titulo}')">
        ${book.favorito ? '★ Remover dos Favoritos' : '☆ Adicionar aos Favoritos'}
      </button>
      <div class="genre">Gênero: ${book.genero}</div>
      <a href="#" onclick="editarLivro('${book.titulo}')">Editar</a>
      <a href="#" onclick="excluirLivro('${book.titulo}')">Excluir</a>
    `;
    document.getElementById('card-list').appendChild(div);
  });

  updateStatusCounts();
  renderGenres();
  renderPaginacao(filtrados.length);
  localStorage.setItem('pagina', paginaAtual);
}

function adicionarLivro() {
  const novo = {
    titulo: document.getElementById('titulo').value,
    autor: document.getElementById('autor').value,
    genero: document.getElementById('genero').value,
    imagem: document.getElementById('imagem').value || 'https://via.placeholder.com/250x160',
    status: document.getElementById('status').value,
    nota: Number(document.getElementById('nota').value) || 0,
    favorito: false
  };

  if (!novo.titulo || !novo.autor) return alert('Título e autor são obrigatórios!');

  if (editandoTitulo) {
    const index = books.findIndex(b => b.titulo === editandoTitulo);
    if (index !== -1) {
      novo.favorito = books[index].favorito;
      books[index] = novo;
    }
    editandoTitulo = null;
  } else {
    books.push(novo);
  }

  saveBooks();
  clearForm();
  render();
}

function editarLivro(titulo) {
  const book = books.find(b => b.titulo === titulo);
  if (!book) return;
  document.getElementById('titulo').value = book.titulo;
  document.getElementById('autor').value = book.autor;
  document.getElementById('genero').value = book.genero;
  document.getElementById('imagem').value = book.imagem;
  document.getElementById('status').value = book.status;
  document.getElementById('nota').value = book.nota;
  editandoTitulo = titulo;
}

function excluirLivro(titulo) {
  books = books.filter(b => b.titulo !== titulo);
  saveBooks();
  render();
}

function toggleFavorito(titulo) {
  const book = books.find(b => b.titulo === titulo);
  if (book) book.favorito = !book.favorito;
  saveBooks();
  render();
}

function clearForm() {
  document.getElementById('titulo').value = '';
  document.getElementById('autor').value = '';
  document.getElementById('genero').value = '';
  document.getElementById('imagem').value = '';
  document.getElementById('status').value = 'A Ler';
  document.getElementById('nota').value = '';
  editandoTitulo = null;
}

function filtrar(status) {
  filtroAtual = status;
  paginaAtual = 1;
  document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  render();
}

function renderGenres() {
  const generos = {};
  books.forEach(book => generos[book.genero] = (generos[book.genero] || 0) + 1);
  const container = document.getElementById('genre-list');
  container.innerHTML = '';
  for (let g in generos) {
    const btn = document.createElement('button');
    btn.innerText = `${g} (${generos[g]})`;
    btn.onclick = () => {
      generoAtual = g;
      paginaAtual = 1;
      render();
    };
    container.appendChild(btn);
  }
}

function updateStatusCounts() {
  document.getElementById('count-lido').innerText = books.filter(b => b.status === 'Lido').length;
  document.getElementById('count-aler').innerText = books.filter(b => b.status === 'A Ler').length;
  document.getElementById('count-queroler').innerText = books.filter(b => b.status === 'Quero Ler').length;
}

function renderPaginacao(total) {
  const totalPages = Math.ceil(total / porPagina);
  const paginacao = document.getElementById('paginacao');
  paginacao.innerHTML = '';
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement('button');
    btn.innerText = i;
    if (i === paginaAtual) btn.style.background = '#005bb5';
    btn.onclick = () => {
      paginaAtual = i;
      render();
    };
    paginacao.appendChild(btn);
  }
}

// Inicialização
render();
document.getElementById('goal').value = localStorage.getItem('goal') || '';
document.getElementById('goal').addEventListener('input', () => {
  localStorage.setItem('goal', document.getElementById('goal').value);
});
</script>
</body>
</html>
