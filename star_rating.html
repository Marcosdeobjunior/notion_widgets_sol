<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Widget de Estrelas</title>
  <style>
    .star-rating {
      display: inline-flex;
      direction: rtl;
      font-size: 2rem;
      cursor: pointer;
    }

    .star-rating span {
      color: #ccc;
      transition: color 0.2s;
    }

    .star-rating span.hovered,
    .star-rating span.selected {
      color: gold;
    }
  </style>
</head>
<body>

  <!-- data-id é usado como chave para localStorage -->
  <div class="star-widget" data-stars="5" data-id="avaliacao-livro-1"></div>
  <div class="star-widget" data-stars="3" data-id="avaliacao-livro-2"></div>

  <script>
    document.querySelectorAll('.star-widget').forEach(widget => {
      let totalStars = parseInt(widget.getAttribute('data-stars')) || 5;
      if (totalStars > 5) totalStars = 5;
      if (totalStars < 1) totalStars = 1;

      const widgetId = widget.getAttribute('data-id') || 'star-widget';
      const savedRating = parseInt(localStorage.getItem(widgetId)) || 0;

      const container = document.createElement('div');
      container.classList.add('star-rating');

      for (let i = totalStars; i >= 1; i--) {
        const star = document.createElement('span');
        star.innerHTML = '★';
        star.dataset.value = i;

        // Aplicar estado salvo
        if (i <= savedRating) {
          star.classList.add('selected');
        }

        // Hover
        star.addEventListener('mouseover', () => {
          container.querySelectorAll('span').forEach(s => {
            s.classList.toggle('hovered', s.dataset.value <= i);
          });
        });

        // Limpa hover
        container.addEventListener('mouseleave', () => {
          container.querySelectorAll('span').forEach(s => {
            s.classList.remove('hovered');
          });
        });

        // Clique
        star.addEventListener('click', () => {
          const rating = i;
          localStorage.setItem(widgetId, rating); // salva
          container.querySelectorAll('span').forEach(s => {
            s.classList.toggle('selected', s.dataset.value <= rating);
          });
          console.log(`Nota salva para ${widgetId}: ${rating}`);
        });

        container.appendChild(star);
      }

      widget.appendChild(container);
    });
  </script>
</body>
</html>
